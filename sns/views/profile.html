{% extends 'layout.html' %}

{% block content %}
  <div class="timeline">
    <!-- π‘‡ 1. ν”λ΅μ‰ λ©λ΅ -->
    <div class="followings half">
      <h2>ν”λ΅μ‰ λ©λ΅</h2>
      {% if user.Followings %} <!-- 1) deserializeUserμ—μ„ req.userμ— followings μ‹¬μ–΄λ†“μ  2) routes/page.jsμ—μ„ res.locals.user = req.user μ„¤μ •ν–μΌλ―€λ΅, μ–΄λ””μ—μ„λ“  userλ¥Ό ν†µν•΄ req.user μ ‘κ·Ό κ°€λ¥ -->
        {% for following in user.Followings %}
          <div>
            <a class="twit-author" style="font-weight: bold; color: rgb(17, 79, 214);" href="post/{{ following.id }}">{{ following.nick }}</a>
            <!-- <span>{{following.nick}}</span> -->
            <button class="twit-unfollow" value="{{ following.id }}">μ–Έν”λ΅μ°</button>  <!-- π‘ [μ–Έν”λ΅μ°] λ²„νΌ -->
          </div>
        {% endfor %}
      {% endif %}
    </div>
    <!-- π‘‡ 2. ν”λ΅μ› λ©λ΅ -->
    <div class="followers half">
      <h2>ν”λ΅μ› λ©λ΅</h2>
      {% if user.Followers %}
        {% for follower in user.Followers %}
        <div>
          <a class="twit-author" style="font-weight: bold; color: rgb(17, 79, 214);" href="post/{{ follower.id }}">{{ follower.nick }}</a>
          <!-- <span>{{follower.nick}}</span>  -->
          {% if not followingIdList.includes(follower.id) %}
            <button class="twit-follow" value="{{ follower.id }}">ν”λ΅μ°</button>  <!-- π‘ [ν”λ΅μ°] λ²„νΌ -->
          {% endif %}
        </div>
        {% endfor %}
      {% endif %}
    </div>
    <!-- π‘‡ 3. μΆ‹μ•„μ” λ©λ΅ -->

  </div>
{% endblock %}

{% block script %}
<script>
    // π‘‡ [ν”λ΅μ°] λ²„νΌ
    document.querySelectorAll('.twit-follow').forEach(function(tag) {
      tag.addEventListener('click', function() {
        const userId = document.querySelector('.twit-follow').value;
        if (confirm('ν”λ΅μ° ν•μ‹κ² μµλ‹κΉ?')) {
            axios.post(`/user/${userId}/follow`) 
            .then(() => {
                  location.reload();
                })
                .catch((err) => {
                  console.error(err);
                });
        }
      });
    });

    // π‘‡ [μ–Έν”λ΅μ°] λ²„νΌ
    document.querySelectorAll('.twit-unfollow').forEach(function(tag) {
      tag.addEventListener('click', function() {
        const userId = document.querySelector('.twit-unfollow').value;
        if (confirm('μ–Έν”λ΅μ° ν•μ‹κ² μµλ‹κΉ?')) {
              axios.post(`/user/${userId}/unfollow`)
                .then(() => {
                  location.reload();
                })
                .catch((err) => {
                  console.error(err);
                });
            }
        });
    });


</script>
{% endblock %}